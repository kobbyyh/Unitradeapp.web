<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Database - Unitrade</title>
    <script src="js/firebase-config-public.js"></script>
    <script src="js/firebase-init.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <h1 class="text-2xl font-bold mb-4">Database Test</h1>
    <div id="status" class="mb-4 p-4 bg-blue-100 rounded">Loading...</div>
    <div id="results" class="bg-white p-4 rounded shadow"></div>
    
    <script type="module">
        import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        console.log('üîç Testing database connection...');
        
        async function testDatabase() {
            try {
                // Firebase configuration
                const firebaseConfig = window.FIREBASE_CONFIG;
                console.log('üîç Firebase config:', firebaseConfig);

                // Initialize Firebase
                const firebaseInit = await window.initializeFirebase(firebaseConfig);
                const db = firebaseInit.db;
                console.log('‚úÖ Firebase initialized successfully');
                
                document.getElementById('status').innerHTML = '‚úÖ Firebase initialized successfully';
                
                // Test items collection
                console.log('üîç Testing items collection...');
                const itemsRef = collection(db, 'items');
                const itemsSnapshot = await getDocs(itemsRef);
                
                console.log('üìä Items collection size:', itemsSnapshot.size);
                document.getElementById('status').innerHTML = `‚úÖ Found ${itemsSnapshot.size} items in database`;
                
                let resultsHtml = `<h3 class="text-lg font-semibold mb-4">Items in Database (${itemsSnapshot.size} total):</h3>`;
                
                if (itemsSnapshot.empty) {
                    resultsHtml += '<p class="text-red-600">‚ùå No items found in the database!</p>';
                } else {
                    resultsHtml += '<div class="space-y-4">';
                    itemsSnapshot.forEach((doc, index) => {
                        const data = doc.data();
                        resultsHtml += `
                            <div class="border p-4 rounded">
                                <h4 class="font-semibold">Item ${index + 1}: ${doc.id}</h4>
                                <div class="text-sm text-gray-600 mt-2">
                                    <p><strong>Title:</strong> ${data.title || 'No title'}</p>
                                    <p><strong>Price:</strong> ${data.price || 'No price'}</p>
                                    <p><strong>Category:</strong> ${data.category || 'No category'}</p>
                                    <p><strong>isAvailable:</strong> ${data.isAvailable}</p>
                                    <p><strong>isSold:</strong> ${data.isSold}</p>
                                    <p><strong>sellerId:</strong> ${data.sellerId || 'No seller ID'}</p>
                                </div>
                            </div>
                        `;
                    });
                    resultsHtml += '</div>';
                }
                
                document.getElementById('results').innerHTML = resultsHtml;
                
            } catch (error) {
                console.error('‚ùå Error testing database:', error);
                document.getElementById('status').innerHTML = '‚ùå Error: ' + error.message;
                document.getElementById('results').innerHTML = `<p class="text-red-600">Error details: ${error.message}</p>`;
            }
        }
        
        // Start the test
        testDatabase();
    </script>
</body>
</html>
